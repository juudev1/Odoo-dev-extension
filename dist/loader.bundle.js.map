{"version":3,"file":"loader.bundle.js","mappings":";;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAOA;;AAEA;AAAA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AAEA;AACA;AAAA;AAAA;AACA;AACA;AACA;;AAEA;AAAA;AAAA;AAAA;AA8BA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AACA;AACA;AAOA;AAIA;AACA;AAAA;AAAA;AAAA;AAGA;AACA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AA9FA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AA2BA;AACA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAqCA;;;;;;AClGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;ACvBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;ACPA;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACLA;AAAA;AAAA;AADA;AACA;AAAA;AAEA;AAAA;AAAA;AAAA;AACA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAwBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAxCA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AAEA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAIA;AACA;AAGA;AACA;AACA;AAwBA;AACA;AAAA;AAEA;AAAA;AAAA;AACA;;AAEA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAIA;AAAA;AAAA;AAKA;AAEA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AAGA;AACA;AAEA;AACA;AACA;AACA;AAWA;AAAA;AACA;AAEA;AACA;AACA;AAAA;AACA;AAEA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA","sources":["webpack://odoo_dev/./src/injected/core/extension-core.js","webpack://odoo_dev/webpack/bootstrap","webpack://odoo_dev/webpack/runtime/define property getters","webpack://odoo_dev/webpack/runtime/hasOwnProperty shorthand","webpack://odoo_dev/webpack/runtime/make namespace object","webpack://odoo_dev/./src/injected/index.js"],"sourcesContent":["// src/injected/core/extension-core.js\r\nclass ExtensionCore {\r\n    static #extensionData = null;\r\n    static #initialized = false;\r\n    static #resolveInitPromise = null;\r\n    static #rejectInitPromise = null;\r\n    static #initPromise = null;\r\n    static #timeoutId = null;\r\n    static #isEnabled = true; // Default, will be updated\r\n\r\n    static init() {\r\n        if (this.#initialized) return Promise.resolve(this.#extensionData);\r\n        if (this.#initPromise) return this.#initPromise;\r\n\r\n        this.#initPromise = new Promise((resolve, reject) => {\r\n            this.#resolveInitPromise = resolve;\r\n            this.#rejectInitPromise = reject;\r\n\r\n            this.#timeoutId = setTimeout(() => {\r\n                console.error('[ExtensionCore] Timeout waiting for EXTENSION_INIT message.');\r\n                this.#rejectInitPromise(new Error('Timeout waiting for extension data'));\r\n                window.removeEventListener('message', this.#handleInitMessageWrapper);\r\n            }, 5000);\r\n\r\n            // Use a wrapper function for the event listener so 'this' refers to ExtensionCore\r\n            window.addEventListener('message', this.#handleInitMessageWrapper);\r\n\r\n            console.log('[ExtensionCore] Requesting EXTENSION_INIT data...');\r\n            window.postMessage({ type: 'REQUEST_EXTENSION_INIT' }, '*');\r\n        });\r\n        return this.#initPromise;\r\n    }\r\n\r\n    // Wrapper to ensure 'this' context is correct for static method\r\n    static #handleInitMessageWrapper = (event) => {\r\n        this.#handleInitMessage(event);\r\n    }\r\n\r\n    static #handleInitMessage = (event) => {\r\n        if (event.source === window && event.data && (event.data.type === 'EXTENSION_INIT' || event.data.type === 'EXTENSION_INIT_ERROR')) {\r\n            clearTimeout(this.#timeoutId);\r\n            window.removeEventListener('message', this.#handleInitMessageWrapper);\r\n\r\n            if (event.data.type === 'EXTENSION_INIT_ERROR') {\r\n                console.error('[ExtensionCore] Received EXTENSION_INIT_ERROR:', event.data.error);\r\n                this.#initialized = false; // Mark as not initialized properly\r\n                if (this.#rejectInitPromise) {\r\n                    this.#rejectInitPromise(new Error(event.data.error || 'Failed to initialize extension data'));\r\n                }\r\n            } else {\r\n                console.log('[ExtensionCore] Received EXTENSION_INIT:', event.data.data);\r\n                this.#extensionData = event.data.data;\r\n                this.#isEnabled = this.#extensionData.isEnabled !== false; // Update enabled state\r\n                this.#initialized = true;\r\n                if (this.#resolveInitPromise) {\r\n                    this.#resolveInitPromise(this.#extensionData);\r\n                }\r\n            }\r\n            this.#resolveInitPromise = null;\r\n            this.#rejectInitPromise = null;\r\n        }\r\n    }\r\n\r\n    static getUrl(path = '') {\r\n        if (!this.#initialized) throw new Error('Extension not initialized');\r\n        return `${this.#extensionData.url}${path}`;\r\n    }\r\n\r\n    static get resources() {\r\n        if (!this.#isEnabled) return { templates: [], css: [] }; // Return empty if disabled\r\n        return {\r\n            templates: [\r\n                this.getUrl('src/injected/views/list/list_renderer.xml'),\r\n                this.getUrl('src/injected/views/form/form_view.xml'),\r\n                this.getUrl('src/injected/views/field.xml'),\r\n                this.getUrl('src/injected/views/view_button/view_button.xml'),\r\n                this.getUrl('src/injected/views/custom/sidebar_dev.xml'),\r\n            ],\r\n            css: [\r\n                this.getUrl('src/injected/tooltip/css/tooltip.css'),\r\n                this.getUrl('src/injected/views/custom/sidebar_dev.css'),\r\n            ],\r\n        };\r\n    }\r\n\r\n    static get extensionData() {\r\n        return this.#extensionData;\r\n    }\r\n\r\n    static get isEnabled() {\r\n        // Ensure init has run to get the latest state, but don't block indefinitely if init failed\r\n        if (!this.#initialized && this.#initPromise) {\r\n            console.warn(\"[ExtensionCore] isEnabled accessed before full initialization, relying on default or last known state.\");\r\n        }\r\n        return this.#isEnabled;\r\n    }\r\n}\r\n\r\nexport default ExtensionCore;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// src/injected/index.js\r\nimport ExtensionCore from './core/extension-core.js';\r\n\r\nasync function initializeOdooDev() {\r\n    \"use strict\";\r\n\r\n    try {\r\n        // 1. Initialize ExtensionCore to get basic data (URL, etc.)\r\n        console.log(\"[Odoo Dev Index] Initializing ExtensionCore...\");\r\n        await ExtensionCore.init();\r\n        window.ExtensionCore = ExtensionCore; // Make it globally available\r\n        console.log(\"[Odoo Dev Index] ExtensionCore initialized. Extension Enabled:\", ExtensionCore.isEnabled);\r\n\r\n        if (!ExtensionCore.isEnabled) {\r\n            console.log(\"[Odoo Dev Index] Extension is disabled by configuration. Halting Odoo module injections.\");\r\n            // Any previously injected elements/patches from a prior enabled state\r\n            // will be gone due to the page reload forced by contentScriptIsolated.js.\r\n            return;\r\n        }\r\n\r\n        const extensionUrl = ExtensionCore.getUrl();\r\n        const srcFolder = extensionUrl + \"src/injected/\";\r\n\r\n        // Create a script global with the URL of the extension\r\n        const globalUrlScript = document.createElement(\"script\");\r\n        globalUrlScript.textContent = `window.__devExtensionUrl = \"${extensionUrl}\";`;\r\n        document.head.appendChild(globalUrlScript);\r\n\r\n        // Function to dynamically load scripts\r\n        function loadScript(path) {\r\n            const url = new URL(path, srcFolder);\r\n            console.log(\"[Odoo Dev Index] Requesting script:\", path);\r\n            return new Promise((resolve, reject) => {\r\n                let script = document.createElement(\"script\");\r\n                script.src = url.href;\r\n                script.type = \"module\"; // Assuming all are modules\r\n                script.onload = () => {\r\n                    console.log(\"[Odoo Dev Index] Loaded script:\", path);\r\n                    resolve(path);\r\n                };\r\n                script.onerror = (err) => {\r\n                    const errorMsg = `Failed to load script: ${path} from ${url.href}`;\r\n                    console.error(\"[Odoo Dev Index]\", errorMsg, err);\r\n                    reject(new Error(errorMsg));\r\n                };\r\n                document.head.appendChild(script);\r\n            });\r\n        }\r\n\r\n        // Check if we should inject modules\r\n        var isWebModule = (window.location.pathname.includes('/web') && !window.location.pathname.includes('/web/login') && !window.location.pathname.includes('/web/signup')) || window.location.pathname.includes('/odoo');\r\n        const hasFileLoaded = document.querySelector('input[type=\"file\"]') !== null;\r\n\r\n        if (isWebModule || hasFileLoaded) {\r\n            console.log(\"[Odoo Dev Index] Conditions met, injecting Odoo modules...\");\r\n\r\n            // 2. Load odoo_version_utils.js (needed by bundle_xml.js)\r\n            // This defines 'odoo_dev.version_utils'\r\n            await loadScript(\"./utils/odoo_version_utils.js\");\r\n\r\n            // 3. Load bundle_xml.js (defines 'odoo_dev.bundle.xml' and how to load templates)\r\n            // This module itself requires 'odoo_dev.version_utils'\r\n            await loadScript(\"./templates/bundle_xml.js\");\r\n\r\n            // 4. Load client.js. This script file contains an odoo.define that\r\n            //    will internally load templates using 'odoo_dev.bundle.xml'.\r\n            //    It also sets up `window.odooDevClientReadyPromise`.\r\n            await loadScript(\"./core/client.js\");\r\n\r\n            // 5. IMPORTANT: Wait for client.js's *internal* async operations (template loading) to complete.\r\n            console.log(\"[Odoo Dev Index] Waiting for client.js internal initialization (template/CSS loading)...\");\r\n            if (window.odooDevClientReadyPromise) {\r\n                await window.odooDevClientReadyPromise;\r\n                console.log(\"[Odoo Dev Index] client.js has finished its internal initialization.\");\r\n            } else {\r\n                // This should not happen if client.js is structured correctly\r\n                console.warn(\"[Odoo Dev Index] window.odooDevClientReadyPromise was not set by client.js. Proceeding, but templates might not be ready.\");\r\n            }\r\n\r\n            // 6. Now that templates are loaded, load all other scripts.\r\n            console.log(\"[Odoo Dev Index] Loading remaining UI components and patches...\");\r\n            const remainingScripts = [\r\n                // ExtensionCore is already an ES Module import, no need to loadScript it.\r\n                // bundle_xml.js and client.js already loaded.\r\n                // odoo_version_utils.js already loaded.\r\n\r\n                // ****** Services ******\r\n                \"./tooltip/js/dev_info_service.js\",\r\n                \"./services/active_record.js\",\r\n\r\n                // ****** Components ******\r\n                \"./views/custom/field_xpath.js\",\r\n\r\n                \"./views/custom/sidebar_dev.js\", // Antes que el form_controller.js para que se actualice el resModel\r\n                \"./views/form/form_controller.js\",\r\n                // ****** Webclient Patches ******\r\n                \"./webclient.js\",\r\n\r\n                \"./tooltip/js/tooltip.js\",\r\n\r\n                \"./views/form/form_compiler.js\",\r\n                \"./views/list/list_renderer.js\",\r\n                \"./views/view_button/view_button.js\",\r\n                \"./views/field.js\",\r\n                \"./form_label.js\"\r\n            ];\r\n\r\n            // Load remaining scripts in parallel\r\n            await Promise.all(remainingScripts.map(scriptPath => loadScript(scriptPath)\r\n                .catch(err => {\r\n                    // Log individual script load errors but don't necessarily stop all others\r\n                    console.error(`[Odoo Dev Index] Non-critical error loading script: ${err.message}. Some features might be affected.`);\r\n                })\r\n            ));\r\n\r\n            console.log(\"[Odoo Dev Index] All specified injected scripts have been processed.\");\r\n\r\n        } else {\r\n            console.log(\"[Odoo Dev Index] Conditions not met, no Odoo modules injected.\");\r\n        }\r\n    } catch (error) {\r\n        console.error(\"[Odoo Dev Index] Critical error during extension initialization:\", error);\r\n    }\r\n}\r\n\r\n(async () => {\r\n    // The `REQUEST_EXTENSION_INIT` message will be sent by ExtensionCore.init()\r\n    // The response `EXTENSION_INIT` will be handled by ExtensionCore.init()'s promise.\r\n    // Then initializeOdooDev will run.\r\n    await initializeOdooDev();\r\n})();"],"names":[],"sourceRoot":""}